---
phase: 01-app-shell-hotkey-floating-panel
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - QuickTask/Package.swift
  - QuickTask/Sources/App/QuickTaskApp.swift
  - QuickTask/Sources/App/AppDelegate.swift
  - QuickTask/Sources/Info.plist
  - QuickTask/Sources/Views/ContentView.swift
autonomous: true
requirements:
  - SHELL-02

must_haves:
  truths:
    - "App launches with no Dock icon visible"
    - "App compiles and runs without errors via swift build"
    - "KeyboardShortcuts and Defaults SPM packages resolve successfully"
  artifacts:
    - path: "QuickTask/Package.swift"
      provides: "SPM executable package with macOS 14 target, KeyboardShortcuts and Defaults dependencies"
      contains: "PackageDescription"
    - path: "QuickTask/Sources/App/QuickTaskApp.swift"
      provides: "@main app entry point with AppDelegate adapter"
      contains: "@main"
    - path: "QuickTask/Sources/App/AppDelegate.swift"
      provides: "AppDelegate class with applicationDidFinishLaunching"
      contains: "class AppDelegate"
    - path: "QuickTask/Sources/Info.plist"
      provides: "LSUIElement = YES to suppress Dock icon"
      contains: "LSUIElement"
  key_links:
    - from: "QuickTask/Sources/App/QuickTaskApp.swift"
      to: "QuickTask/Sources/App/AppDelegate.swift"
      via: "@NSApplicationDelegateAdaptor"
      pattern: "NSApplicationDelegateAdaptor.*AppDelegate"
---

<objective>
Create the SPM executable package for QuickTask, add dependencies (KeyboardShortcuts 2.4.0, Defaults 9.0.6), configure Info.plist for menu bar agent behavior (LSUIElement), and set up the AppDelegate-based app lifecycle.

Purpose: Establish the project scaffold that all subsequent plans build on. The LSUIElement configuration and AppDelegate pattern are foundational — getting these wrong forces a painful restructuring later.

Output: A compilable, runnable SPM executable package with no Dock icon, correct deployment target (macOS 14.0), and both SPM dependencies resolved.
</objective>

<execution_context>
@/home/rob/.claude/get-shit-done/workflows/execute-plan.md
@/home/rob/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SPM executable package and configure dependencies</name>
  <files>
    QuickTask/Package.swift
    QuickTask/Sources/Info.plist
  </files>
  <action>
Create a Swift Package Manager executable package for QuickTask. This is a CLI-only environment (no Xcode GUI), so we use SPM directly — NOT an .xcodeproj.

1. Create the directory structure:
   ```
   QuickTask/
   ├── Package.swift
   └── Sources/
       ├── App/
       │   ├── QuickTaskApp.swift
       │   └── AppDelegate.swift
       ├── Views/
       │   └── ContentView.swift
       ├── Panel/
       ├── Hotkey/
       ├── Info.plist
       └── Resources/
           └── Assets.xcassets/
               └── Contents.json
   ```

2. Create `Package.swift` at `QuickTask/Package.swift`:
   ```swift
   // swift-tools-version: 5.10
   import PackageDescription

   let package = Package(
       name: "QuickTask",
       platforms: [.macOS(.v14)],
       dependencies: [
           .package(url: "https://github.com/sindresorhus/KeyboardShortcuts", from: "2.4.0"),
           .package(url: "https://github.com/sindresorhus/Defaults", from: "9.0.0"),
       ],
       targets: [
           .executableTarget(
               name: "QuickTask",
               dependencies: ["KeyboardShortcuts", "Defaults"],
               path: "Sources",
               resources: [
                   .copy("Info.plist"),
                   .copy("Resources"),
               ]
           ),
       ]
   )
   ```
   Use swift-tools-version 5.10 (not 6.0) to avoid strict concurrency issues that could block initial compilation. The app targets macOS 14.0 minimum.

3. Create `Sources/Info.plist` with:
   - `LSUIElement` = `YES` (Boolean true) — suppresses Dock icon per SHELL-02
   - `CFBundleName` = `QuickTask`
   - `CFBundleDisplayName` = `QuickTask`
   - `CFBundleIdentifier` = `com.quicktask.app`
   - Standard macOS app keys (CFBundleVersion, CFBundleShortVersionString, etc.)

   NOTE: For SPM executables, Info.plist is bundled as a resource. The LSUIElement key must be applied at runtime using `NSApp.setActivationPolicy(.accessory)` in AppDelegate.applicationDidFinishLaunching — this is the reliable approach for SPM-based apps. The Info.plist is still created for documentation/future Xcode project generation, but the runtime call is what actually suppresses the Dock icon.

4. Create minimal `Sources/Resources/Assets.xcassets/Contents.json`:
   ```json
   {
     "info": {
       "version": 1,
       "author": "xcode"
     }
   }
   ```

IMPORTANT: Do NOT create an .xcodeproj. This project uses SPM exclusively. All source files live under `QuickTask/Sources/`. The `swift build` and `swift run QuickTask` commands are the build/run workflow.
  </action>
  <verify>
Run `cd /home/rob/projects/todo-app/QuickTask && swift package resolve` — both KeyboardShortcuts and Defaults packages download successfully. Package.resolved is created.
  </verify>
  <done>
SPM package exists at QuickTask/ with Package.swift, both dependencies resolve. Info.plist contains LSUIElement = YES. Directory structure is ready for source files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AppDelegate and app entry point with LSUIElement behavior</name>
  <files>
    QuickTask/Sources/App/QuickTaskApp.swift
    QuickTask/Sources/App/AppDelegate.swift
    QuickTask/Sources/Views/ContentView.swift
  </files>
  <action>
Create the app entry point and AppDelegate:

1. `Sources/App/QuickTaskApp.swift`:
   - Use `@main` attribute on the App struct
   - Declare `@NSApplicationDelegateAdaptor(AppDelegate.self) var appDelegate`
   - Body returns a minimal `Settings { EmptyView() }` scene (or `WindowGroup` that is immediately hidden) — the real UI lives in the NSPanel created in Plan 02. For now, just have a valid scene body. Do NOT use `MenuBarExtra` per research decisions.

2. `Sources/App/AppDelegate.swift`:
   - Class `AppDelegate: NSObject, NSApplicationDelegate`
   - `applicationDidFinishLaunching(_:)`:
     - Call `NSApp.setActivationPolicy(.accessory)` to suppress the Dock icon. This is the reliable runtime approach for SPM executables where Info.plist LSUIElement may not be picked up automatically.
     - Print a log message confirming launch: `print("[QuickTask] App launched as menu bar agent")`
   - This class will be extended in Plan 02 to hold the NSStatusItem (strong reference) and PanelManager.

3. `Sources/Views/ContentView.swift`:
   - Minimal SwiftUI view with `Text("QuickTask")` centered. This is a placeholder that will be replaced with the actual task capture UI in Phase 2. It will be hosted inside the NSPanel in Plan 02.
   - Set frame to approximately 400x300 to simulate final panel size.

CRITICAL per research: AppDelegate MUST be a class (not struct), MUST inherit NSObject, MUST conform to NSApplicationDelegate. The `@NSApplicationDelegateAdaptor` wiring ensures it is created and retained by SwiftUI's app lifecycle.
  </action>
  <verify>
Run `cd /home/rob/projects/todo-app/QuickTask && swift build` — project compiles with zero errors. Run `swift run QuickTask &` briefly and confirm console output "[QuickTask] App launched as menu bar agent". Kill the process. Verify no Dock icon appeared during the brief run.
  </verify>
  <done>
App compiles and launches as a menu bar agent (no Dock icon). AppDelegate.applicationDidFinishLaunching fires with NSApp.setActivationPolicy(.accessory). ContentView placeholder exists for NSPanel hosting in Plan 02. SHELL-02 is satisfied.
  </done>
</task>

</tasks>

<verification>
1. `swift build` in QuickTask/ completes with zero errors
2. KeyboardShortcuts and Defaults packages are listed in Package.resolved
3. Running the app shows no Dock icon
4. AppDelegate.applicationDidFinishLaunching is called (verify via console output)
5. Info.plist contains LSUIElement = YES
6. All source files are under QuickTask/Sources/ (SPM layout, no .xcodeproj)
</verification>

<success_criteria>
- Compilable SPM executable package with both dependencies resolved
- App runs as menu bar agent with no Dock icon (SHELL-02)
- AppDelegate is wired and fires on launch
- ContentView placeholder exists for NSPanel hosting in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/01-app-shell-hotkey-floating-panel/01-01-SUMMARY.md`
</output>
