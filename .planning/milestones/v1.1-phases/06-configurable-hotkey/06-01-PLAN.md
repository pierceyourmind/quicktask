---
phase: 06-configurable-hotkey
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - QuickTask/Package.swift
  - QuickTask/Sources/Settings/SettingsView.swift
  - QuickTask/Sources/App/AppDelegate.swift
autonomous: true
requirements:
  - HOTK-01
  - HOTK-02
  - HOTK-03

must_haves:
  truths:
    - "Settings window contains a hotkey recorder field where clicking and pressing a key combination records a new shortcut"
    - "After recording a new shortcut, it immediately toggles the panel without restarting the app"
    - "A Reset to Default button in Settings restores the shortcut to Ctrl+Option+Space"
  artifacts:
    - path: "QuickTask/Package.swift"
      provides: "KeyboardShortcuts dependency bumped to from: 2.4.0"
      contains: 'from: "2.4.0"'
    - path: "QuickTask/Sources/Settings/SettingsView.swift"
      provides: "Hotkey recorder and reset button in Settings form"
      contains: "KeyboardShortcuts.Recorder"
    - path: "QuickTask/Sources/App/AppDelegate.swift"
      provides: "Settings NSWindow contentRect height increased to accommodate new section"
      contains: "height: 250"
  key_links:
    - from: "QuickTask/Sources/Settings/SettingsView.swift"
      to: "KeyboardShortcuts.Name.togglePanel"
      via: "Recorder(name: .togglePanel)"
      pattern: 'Recorder.*\.togglePanel'
    - from: "QuickTask/Sources/Settings/SettingsView.swift"
      to: "KeyboardShortcuts.reset"
      via: "Reset to Default button action"
      pattern: 'KeyboardShortcuts\.reset\(\.togglePanel\)'
---

<objective>
Add a configurable hotkey feature to the existing Settings window. Users can record a custom global shortcut to replace the default Ctrl+Option+Space, and reset it back to the default with one click.

Purpose: Users whose default shortcut conflicts with another app need a way to change it without editing code.
Output: Updated Package.swift (dependency bump), SettingsView.swift (recorder + reset UI), AppDelegate.swift (window height increase).
</objective>

<execution_context>
@/home/rob/.claude/get-shit-done/workflows/execute-plan.md
@/home/rob/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-configurable-hotkey/06-RESEARCH.md
@QuickTask/Package.swift
@QuickTask/Sources/Settings/SettingsView.swift
@QuickTask/Sources/App/AppDelegate.swift
@QuickTask/Sources/Hotkey/HotkeyService.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bump KeyboardShortcuts dependency to v2.4.0+</name>
  <files>QuickTask/Package.swift</files>
  <action>
In `QuickTask/Package.swift`, change the KeyboardShortcuts dependency from pinned v1.10.0 to a range starting at v2.4.0:

Replace:
```swift
.package(url: "https://github.com/sindresorhus/KeyboardShortcuts", exact: "1.10.0"),
```
With:
```swift
.package(url: "https://github.com/sindresorhus/KeyboardShortcuts", from: "2.4.0"),
```

After editing, run `swift package resolve` from the `QuickTask/` directory to update `Package.resolved` with the new version. If the command fails due to Linux toolchain limitations (this is a macOS-only project on a Linux dev machine), note the failure but proceed — the resolution will complete on macOS at build time.

Do NOT change the Defaults dependency or any other part of Package.swift.
  </action>
  <verify>
Verify the file contains `from: "2.4.0"` for KeyboardShortcuts:
```bash
grep 'KeyboardShortcuts.*from.*2.4.0' QuickTask/Package.swift
```
  </verify>
  <done>Package.swift declares KeyboardShortcuts dependency as `from: "2.4.0"` instead of `exact: "1.10.0"`.</done>
</task>

<task type="auto">
  <name>Task 2: Add hotkey recorder and reset button to Settings, grow window</name>
  <files>
    QuickTask/Sources/Settings/SettingsView.swift
    QuickTask/Sources/App/AppDelegate.swift
  </files>
  <action>
**SettingsView.swift — Add recorder section and grow frame:**

1. Add `import KeyboardShortcuts` at the top of the file (after existing imports).

2. Inside the `Form`, after the existing "General" `Section` closing brace, add a new section:
```swift
Section {
    KeyboardShortcuts.Recorder("Toggle Panel:", name: .togglePanel)
    Button("Reset to Default") {
        KeyboardShortcuts.reset(.togglePanel)
    }
} header: {
    Text("Keyboard Shortcut")
}
```

3. Update the `.frame(width: 400, height: 150)` to `.frame(width: 400, height: 250)` to accommodate the new section without clipping.

Do NOT add an `onChange:` callback to the Recorder — immediate effect is automatic (the library's Carbon layer re-registers the hotkey when UserDefaults changes). Do NOT use `setShortcut(nil)` for the reset — that removes the shortcut entirely. `KeyboardShortcuts.reset(.togglePanel)` restores the `default:` value defined in `HotkeyService.swift` (`Ctrl+Option+Space`).

**AppDelegate.swift — Grow the Settings NSWindow contentRect:**

In `openSettingsFromMenu()`, update the NSWindow contentRect height from 150 to 250:

Replace:
```swift
contentRect: NSRect(x: 0, y: 0, width: 400, height: 150),
```
With:
```swift
contentRect: NSRect(x: 0, y: 0, width: 400, height: 250),
```

Do NOT change anything else in AppDelegate.swift. No changes are needed in HotkeyService.swift — the `onKeyUp(for: .togglePanel)` handler remains active regardless of which shortcut key is recorded.
  </action>
  <verify>
Verify SettingsView contains the recorder and reset button:
```bash
grep -n "KeyboardShortcuts.Recorder" QuickTask/Sources/Settings/SettingsView.swift
grep -n "KeyboardShortcuts.reset" QuickTask/Sources/Settings/SettingsView.swift
grep -n "height: 250" QuickTask/Sources/Settings/SettingsView.swift
```

Verify AppDelegate NSWindow height is updated:
```bash
grep -n "height: 250" QuickTask/Sources/App/AppDelegate.swift
```

Verify HotkeyService.swift is NOT modified (no changes needed):
```bash
git diff QuickTask/Sources/Hotkey/HotkeyService.swift
```
  </verify>
  <done>
SettingsView displays a "Keyboard Shortcut" section with a `KeyboardShortcuts.Recorder` bound to `.togglePanel` and a "Reset to Default" button calling `KeyboardShortcuts.reset(.togglePanel)`. Both SettingsView frame and AppDelegate NSWindow contentRect are 400x250. HotkeyService.swift is untouched.
  </done>
</task>

</tasks>

<verification>
1. `Package.swift` declares KeyboardShortcuts `from: "2.4.0"` (not `exact: "1.10.0"`)
2. `SettingsView.swift` imports `KeyboardShortcuts`
3. `SettingsView.swift` contains `KeyboardShortcuts.Recorder("Toggle Panel:", name: .togglePanel)` in a "Keyboard Shortcut" section
4. `SettingsView.swift` contains `KeyboardShortcuts.reset(.togglePanel)` in a "Reset to Default" button
5. `SettingsView.swift` frame height is 250
6. `AppDelegate.swift` NSWindow contentRect height is 250
7. `HotkeyService.swift` is unchanged — no handler re-registration logic added
8. No `onChange:` callback on the Recorder
9. No `setShortcut(nil)` anywhere — only `reset()` for restoring default
</verification>

<success_criteria>
- The Settings window has a "Keyboard Shortcut" section with a recorder control and a reset button
- The recorder is wired to `.togglePanel` so recording a new combination updates the global hotkey
- The reset button restores the default shortcut (Ctrl+Option+Space) via `KeyboardShortcuts.reset()`
- The Settings window is tall enough (250pt) to display both sections without clipping
- No unnecessary code added — the library handles persistence, conflict detection, and Carbon re-registration automatically
</success_criteria>

<output>
After completion, create `.planning/phases/06-configurable-hotkey/06-01-SUMMARY.md`
</output>
