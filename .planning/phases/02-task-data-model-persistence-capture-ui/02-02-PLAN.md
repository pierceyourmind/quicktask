---
phase: 02-task-data-model-persistence-capture-ui
plan: "02"
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - QuickTask/Sources/Views/ContentView.swift
  - QuickTask/Sources/Views/TaskInputView.swift
  - QuickTask/Sources/Views/TaskListView.swift
autonomous: true
requirements: [CAPT-01, CAPT-02, CAPT-03, CAPT-04]

must_haves:
  truths:
    - "Text field is auto-focused every time the panel opens — no click required"
    - "Typing a task and pressing Return adds it to the list"
    - "Text field clears after a task is added, ready for next entry"
    - "Tasks appear in a list below the text field"
  artifacts:
    - path: "QuickTask/Sources/Views/ContentView.swift"
      provides: "Root layout composing TaskInputView and TaskListView"
      contains: "TaskInputView"
    - path: "QuickTask/Sources/Views/TaskInputView.swift"
      provides: "Text field with auto-focus and Return-to-add behavior"
      contains: "didBecomeKeyNotification"
    - path: "QuickTask/Sources/Views/TaskListView.swift"
      provides: "Scrollable list of tasks from TaskStore"
      contains: "List"
  key_links:
    - from: "QuickTask/Sources/Views/TaskInputView.swift"
      to: "QuickTask/Sources/Store/TaskStore.swift"
      via: "@Environment(TaskStore.self) calling store.add(title:)"
      pattern: "store\\.add"
    - from: "QuickTask/Sources/Views/TaskInputView.swift"
      to: "NSWindow.didBecomeKeyNotification"
      via: "onReceive notification for auto-focus on every panel show"
      pattern: "didBecomeKeyNotification"
    - from: "QuickTask/Sources/Views/ContentView.swift"
      to: "QuickTask/Sources/Views/TaskInputView.swift"
      via: "VStack composition"
      pattern: "TaskInputView"
    - from: "QuickTask/Sources/Views/ContentView.swift"
      to: "QuickTask/Sources/Views/TaskListView.swift"
      via: "VStack composition"
      pattern: "TaskListView"
---

<objective>
Replace the placeholder ContentView with the task capture UI: a text input field that auto-focuses on every panel open, adds tasks on Return, and clears for the next entry, with a task list displayed below.

Purpose: Delivers the core capture experience — the user presses the hotkey, types, hits Return, and sees the task appear. The auto-focus on every panel open (not just first open) is the critical UX requirement that makes the "one hotkey + a few keystrokes" promise work.

Output: ContentView.swift replaced with real layout, TaskInputView.swift created with auto-focus + onSubmit, TaskListView.swift created as a minimal list (TaskRowView with checkbox/delete comes in Plan 03).
</objective>

<execution_context>
@/home/rob/.claude/get-shit-done/workflows/execute-plan.md
@/home/rob/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-task-data-model-persistence-capture-ui/02-RESEARCH.md
@.planning/phases/02-task-data-model-persistence-capture-ui/02-01-SUMMARY.md
@QuickTask/Sources/Views/ContentView.swift
@QuickTask/Sources/Store/TaskStore.swift
@QuickTask/Sources/Model/Task.swift
@QuickTask/Sources/Panel/FloatingPanel.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TaskInputView with auto-focus and Return-to-add</name>
  <files>
    QuickTask/Sources/Views/TaskInputView.swift
  </files>
  <action>
Create TaskInputView.swift — the text field that captures tasks.

**QuickTask/Sources/Views/TaskInputView.swift:**
- `import SwiftUI` and `import AppKit` (needed for NSWindow.didBecomeKeyNotification)
- `struct TaskInputView: View`
- `@Environment(TaskStore.self) private var store`
- `@FocusState private var inputFocused: Bool`
- `@State private var text = ""`
- Body: `TextField("Add a task...", text: $text)` with modifiers:
  - `.textFieldStyle(.plain)` — clean look, no border chrome
  - `.focused($inputFocused)` — binds FocusState
  - `.onSubmit { submitTask() }` — fires on Return key (NOT onCommit, which is deprecated)
  - `.onReceive(NotificationCenter.default.publisher(for: NSWindow.didBecomeKeyNotification))` — CRITICAL for auto-focus on every panel re-show. This notification fires every time the panel becomes the key window, including re-shows after hide. `onAppear` only fires once because the panel reuses the same NSHostingView (orderOut/orderFront, not close/recreate). Inside the handler: `DispatchQueue.main.async { inputFocused = true }` — the async dispatch is required because the window may not be fully key at notification time
- Private `submitTask()` method:
  - Call `store.add(title: text)` — TaskStore.add() already guards against empty/whitespace titles
  - Set `text = ""` to clear the field
  - `DispatchQueue.main.async { inputFocused = true }` to re-focus after submit so the user can immediately type the next task
- Add `.font(.body)` and `.padding()` on the TextField for comfortable input area

Do NOT use `onAppear` for focus — it only fires once on the first panel show because FloatingPanel reuses its NSHostingView. The NSWindow.didBecomeKeyNotification approach fires on EVERY panel open. This is the critical nuance documented in research (Pitfall 1).
  </action>
  <verify>
Verify TaskInputView.swift contains:
- `@Environment(TaskStore.self)`
- `@FocusState private var inputFocused`
- `didBecomeKeyNotification` in an onReceive
- `.focused($inputFocused)`
- `.onSubmit`
- `store.add(title: text)`
- `text = ""`
- `DispatchQueue.main.async`
  </verify>
  <done>
TaskInputView exists with @FocusState auto-focus driven by NSWindow.didBecomeKeyNotification (not onAppear), onSubmit calling store.add(title:) then clearing text and re-focusing. The text field will auto-focus on every panel open, not just the first.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace ContentView and create minimal TaskListView</name>
  <files>
    QuickTask/Sources/Views/ContentView.swift
    QuickTask/Sources/Views/TaskListView.swift
  </files>
  <action>
Replace the placeholder ContentView with the real layout and create a minimal TaskListView that Plan 03 will enhance with TaskRowView.

**QuickTask/Sources/Views/ContentView.swift:**
- Replace the entire placeholder (currently just `Text("QuickTask")`)
- New body: `VStack(spacing: 0)` containing:
  1. `TaskInputView().padding()` — the input field with comfortable padding
  2. `Divider()` — visual separator between input and list
  3. `TaskListView()` — the task list fills remaining space
- `.frame(width: 400, height: 300)` — keep the fixed 400x300 panel size from Phase 1 (dynamic sizing is Phase 3 polish per research Open Question 2)
- `.background(.regularMaterial)` — frosted glass appearance matching Spotlight style

**QuickTask/Sources/Views/TaskListView.swift:**
- Create a minimal but functional list view. This will be enhanced in Plan 03 with TaskRowView (checkbox, strikethrough, delete), but it must show tasks NOW so Plan 02 can verify CAPT-04.
- `struct TaskListView: View`
- `@Environment(TaskStore.self) private var store`
- Body: `List(store.tasks) { task in Text(task.title) }` with `.listStyle(.plain)`
- This is intentionally minimal — Plan 03 replaces the `Text(task.title)` body with `TaskRowView(task: task)` and adds full checkbox/strikethrough/delete behavior

Do NOT add `.listRowSeparator(.hidden)` yet — that is Plan 03's concern when TaskRowView provides its own visual structure.
  </action>
  <verify>
Verify:
- ContentView.swift contains `TaskInputView()`, `Divider()`, `TaskListView()`, `.frame(width: 400, height: 300)`, `.background(.regularMaterial)`
- ContentView.swift does NOT contain the old placeholder `Text("QuickTask")`
- TaskListView.swift contains `@Environment(TaskStore.self)`, `List(store.tasks)`, `.listStyle(.plain)`
  </verify>
  <done>
ContentView is replaced with VStack layout containing TaskInputView + Divider + TaskListView at 400x300 with regularMaterial background. TaskListView shows task titles in a plain-style List. The full capture flow works: user types, presses Return, sees the task appear in the list below.
  </done>
</task>

</tasks>

<verification>
- TaskInputView uses NSWindow.didBecomeKeyNotification (NOT onAppear) for auto-focus
- TaskInputView calls store.add(title:) on submit and clears text to ""
- TaskInputView re-focuses after submit via DispatchQueue.main.async
- ContentView composes TaskInputView + Divider + TaskListView in a VStack
- ContentView maintains 400x300 frame size from Phase 1
- TaskListView reads from @Environment(TaskStore.self) and displays tasks in a List
- No placeholder text remains in ContentView
</verification>

<success_criteria>
- When panel opens, text field auto-focuses on every open (not just first) via didBecomeKeyNotification
- Typing text and pressing Return calls TaskStore.add() — task appears in list below
- Text field clears after submit and re-focuses for next entry
- Tasks display in a scrollable List below the input field
- Panel maintains 400x300 size with frosted glass background
</success_criteria>

<output>
After completion, create `.planning/phases/02-task-data-model-persistence-capture-ui/02-02-SUMMARY.md`
</output>
